version: 2.1

orbs:
  gcp-cli: circleci/gcp-cli@2.4.1

jobs:
  deploy:
    docker:
      - image: google/cloud-sdk:404.0.0-alpine
    steps:
      - checkout
      # - gcp-cli/install
      # - gcp-cli/initialize
      - run:
          name: Deploy To GAE
          command: |
            gcloud app deploy

workflows:
  # install_and_configure_cli:
  #   jobs:
  #     - gcp-cli/install_and_initialize_cli:
  #         context: myContext
  #         executor: gcp-cli/default
  deploy_to_gae_workflow:
    jobs:
      - gcp-cli/install_and_initialize_cli:
          context: myContext
          executor: gcp-cli/default
      - deploy
          requires:
            - gcp-cli/install_and_initialize_cli
